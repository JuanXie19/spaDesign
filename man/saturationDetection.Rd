% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/saturationDetection.r
\name{saturationDetection}
\alias{saturationDetection}
\title{Detect Saturation Point in Sequencing Depth Analysis}
\usage{
saturationDetection(
  data,
  metric_col = "NMI",
  depth_col = "seq_depth",
  group_cols = NULL,
  pilot_depth = NULL,
  slope_threshold = 0.05,
  required_metric_percentage = 0.8,
  k = 7,
  grid_size = 200,
  aggregate_reps = FALSE
)
}
\arguments{
\item{data}{A data frame containing sequencing depth and metric values.}

\item{metric_col}{Character string specifying the column name for the performance metric.
Default is \code{"NMI"}.}

\item{depth_col}{Character string specifying the column name for sequencing depth.
Default is \code{"seq_depth"}.}

\item{group_cols}{Character vector of column names used to stratify the analysis.
If \code{NULL} (default), a single curve is fitted using all rows in \code{data}.
If provided, one curve is fitted per unique group.}

\item{pilot_depth}{Numeric value for pilot sequencing depth. If provided, absolute depth is
computed as \code{depth * pilot_depth} and stored in the output predictions and summary.
Default is \code{NULL}.}

\item{slope_threshold}{Numeric scalar > 0. Slope threshold below which a point is considered
saturated. Default is 0.05.}

\item{required_metric_percentage}{Numeric scalar in (0, 1]. Saturation is only considered after
the predicted metric reaches at least this fraction of the maximum predicted value.
Default is 0.8.}

\item{k}{Integer. Maximum spline basis dimension for the monotone spline. The function will
automatically reduce \code{k} within each group if the dataset is small. Default is 8.}

\item{grid_size}{Integer. Number of depth points used for prediction and slope calculation.
Default is 200.}

\item{aggregate_reps}{Logical. If TRUE, replicate rows at the same depth (within each group)
are averaged before fitting. This can improve stability for small \code{n_rep}. Default is FALSE.}

\item{plot}{Logical. If TRUE, plots are generated (optional). Default is TRUE.}
}
\value{
A list with components:
\itemize{
\item \code{summary}: data frame of saturation results (one row per group)
\item \code{predictions}: list of prediction data frames (one per group)
\item \code{models}: list of fitted SCAM models (one per group; may contain NULL)
\item \code{data}: list of input data split by group
}
}
\description{
Fits a monotone increasing spline model to the relationship between sequencing depth
and a performance metric (e.g., NMI), then identifies the saturation point where
additional sequencing depth yields diminishing improvement.
}
\details{
The function supports two common scenarios:
\itemize{
\item \strong{Single curve:} only one scenario is present (e.g., one \code{prop} value)
\item \strong{Stratified curves:} multiple scenarios exist (e.g., multiple \code{effect_size} levels),
and saturation is detected separately for each level using \code{group_cols}
}
}
\examples{
\dontrun{
# Example 1: single curve (no stratification)
res <- detect_saturation(
  data = rst2,
  metric_col = "NMI",
  depth_col = "seq_depth",
  group_cols = NULL,
  aggregate_reps = TRUE
)
res$summary

# Example 2: stratified curves (by effect size)
res <- detect_saturation(
  data = rst,
  metric_col = "NMI",
  depth_col = "seq_depth",
  group_cols = "effect_size",
  aggregate_reps = TRUE
)
res$summary
}
}
